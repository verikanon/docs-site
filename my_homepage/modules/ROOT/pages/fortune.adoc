= ãã‚‡ã†ã®å ã„ï¼ˆè¶…å‡ã£ãŸç‰ˆï¼‰
:description: ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆãƒ»é‡ã¿ä»˜ããƒ»ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ»ãƒ©ãƒƒã‚­ãƒ¼æƒ…å ±ãƒ»ç”»åƒç”Ÿæˆã¤ã
:page-toclevels: 1

++++
<style>
  /* ===== ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆ#fortune-app é…ä¸‹ã«é™å®šï¼‰ ===== */
  #fortune-app{--bg:#fff8ef;--ink:#222;--accent:#b91c1c;--ink-2:#444;--muted:#7a7a7a;--ring:rgba(185,28,28,.22);--card:#fff;--line:#eee}
  #fortune-app{font-family: "M PLUS Rounded 1c", "Noto Sans JP", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif}
  #fortune-app .wrap{background:linear-gradient(180deg,#fffaf2 0%,#fff 40%,#fff 100%);border:1px solid #eee;border-radius:18px;padding:18px;box-shadow:0 14px 40px rgba(0,0,0,.07)}
  #fortune-app .head{display:flex;align-items:center;gap:12px;margin-bottom:10px}
  #fortune-app .logo{width:44px;height:44px;border-radius:12px;background:var(--accent);color:#fff;display:grid;place-items:center;font-weight:800;box-shadow:0 8px 20px rgba(185,28,28,.25)}
  #fortune-app .title{margin:0;font-size:clamp(18px,3.6vw,24px)}
  #fortune-app .subtitle{margin:0;color:var(--muted);font-size:13px}

  #fortune-app .controls{display:flex;flex-wrap:wrap;gap:10px;margin:14px 0}
  #fortune-app button{appearance:none;cursor:pointer;border:1px solid #ddd;background:#fff;padding:9px 13px;border-radius:12px;font-weight:700;transition:.12s}
  #fortune-app button:hover{box-shadow:0 6px 14px rgba(0,0,0,.06)}
  #fortune-app .btn-primary{background:var(--accent);color:#fff;border-color:transparent}
  #fortune-app .btn-primary:hover{box-shadow:0 8px 18px rgba(185,28,28,.25)}
  #fortune-app .switch{display:flex;align-items:center;gap:8px;font-size:13px;color:#333}
  #fortune-app .select{padding:8px 10px;border-radius:10px;border:1px solid #ddd;background:#fff}

  #fortune-app .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:14px}
  @media (max-width: 820px){#fortune-app .grid{grid-template-columns:1fr;}}
  #fortune-app .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;position:relative;overflow:hidden}
  #fortune-app .badge{display:inline-grid;place-items:center;height:26px;min-width:26px;padding:0 8px;border-radius:999px;background:#fef2f2;color:var(--accent);border:1px solid #fee2e2;font-size:12px;font-weight:800}
  #fortune-app .rank{font-weight:900;font-size:clamp(24px,6vw,36px);letter-spacing:.04em}
  #fortune-app .rank small{font-size:12px;color:var(--muted);font-weight:600;margin-left:8px}
  #fortune-app .msg{margin-top:8px;font-size:clamp(18px,4.6vw,22px);line-height:1.7}
  #fortune-app .msg .k{display:inline-block;background:linear-gradient(transparent 68%, rgba(185,28,28,.15) 0)}
  #fortune-app .topic{margin-top:14px;display:grid;gap:8px}
  #fortune-app .topic .row{display:grid;grid-template-columns:110px 1fr;gap:8px;align-items:start}
  #fortune-app .topic .row .label{color:#555;font-weight:700}
  #fortune-app .topic .row .value{color:#1a1a1a}
  #fortune-app .sep{height:1px;background:linear-gradient(90deg,transparent, #eee, transparent);margin:14px 0}

  #fortune-app .side h3{margin:4px 0 8px 0;font-size:14px;color:#333}
  #fortune-app .pill{display:inline-grid;place-items:center;background:#fafafa;border:1px solid #eee;border-radius:10px;padding:6px 10px;font-size:13px}
  #fortune-app .list{display:grid;gap:8px}
  #fortune-app .kv{display:flex;align-items:center;gap:8px}
  #fortune-app .swatch{width:18px;height:18px;border-radius:6px;border:1px solid rgba(0,0,0,.1)}
  #fortune-app .note{color:#777;font-size:12px;margin-top:6px}
  #fortune-app .history{max-height:160px;overflow:auto;display:grid;gap:6px}
  #fortune-app .history-item{font-size:13px;color:#222}
  #fortune-app .center{display:grid;place-items:center}
  #fortune-app canvas{width:100%;border-radius:14px;border:1px solid #eee}

  /* reveal æ¼”å‡º */
  #fortune-app .reveal{position:absolute;inset:0;background:radial-gradient(1200px 300px at 50% -10%,rgba(185,28,28,.1),transparent 60%);pointer-events:none;opacity:0;animation:reveal .7s ease}
  @keyframes reveal{from{opacity:1;transform:translateY(-6px)}to{opacity:0;transform:translateY(0)}}
</style>

<div id="fortune-app">
  <div class="wrap">
    <div class="head">
      <div class="logo" aria-hidden>å‰</div>
      <div>
        <h2 class="title">ãã‚‡ã†ã®å ã„ï¼ˆè¶…å‡ã£ãŸç‰ˆï¼‰</h2>
        <p class="subtitle">é‡ã¿ä»˜ãã®é‹å‹¢ï¼‹ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ãƒ©ãƒƒã‚­ãƒ¼æƒ…å ±ï¼ç”»åƒç”Ÿæˆãƒ»å…±æœ‰ä»˜ã</p>
      </div>
    </div>

    <div class="controls">
      <button id="roll" class="btn-primary">ãŠã¿ãã˜ã‚’å¼•ã</button>
      <button id="share" title="X/Twitterã§å…±æœ‰">å…±æœ‰</button>
      <button id="copy" title="ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼">ã‚³ãƒ”ãƒ¼</button>
      <select id="cat" class="select" title="é‡ç‚¹ã‚«ãƒ†ã‚´ãƒª">
        <option value="auto">ã‚«ãƒ†ã‚´ãƒªè‡ªå‹•</option>
        <option value="love">æ‹æ„›</option>
        <option value="work">ä»•äº‹</option>
        <option value="money">é‡‘é‹</option>
        <option value="health">å¥åº·</option>
        <option value="study">å­¦ã³</option>
      </select>
      <label class="switch"><input id="daily" type="checkbox" checked> ãã‚‡ã†å›ºå®šï¼ˆæ—¥ä»˜ã‚·ãƒ¼ãƒ‰ï¼‰</label>
      <label class="switch"><input id="norepeat" type="checkbox" checked> åŒã˜çµæœã‚’é¿ã‘ã‚‹</label>
    </div>

    <div class="grid">
      <section class="card main">
        <div class="reveal" hidden></div>
        <div class="badge" id="stamp">NEW</div>
        <div class="rank" id="rank">â€”</div>
        <div class="msg" id="line">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã­</div>

        <div class="topic">
          <div class="row"><div class="label">æ‹æ„›</div><div class="value" id="t-love">â€”</div></div>
          <div class="row"><div class="label">ä»•äº‹</div><div class="value" id="t-work">â€”</div></div>
          <div class="row"><div class="label">é‡‘é‹</div><div class="value" id="t-money">â€”</div></div>
          <div class="row"><div class="label">å¥åº·</div><div class="value" id="t-health">â€”</div></div>
          <div class="row"><div class="label">å­¦ã³</div><div class="value" id="t-study">â€”</div></div>
        </div>

        <div class="sep"></div>

        <div class="topic">
          <div class="row"><div class="label">ãƒ©ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ¼</div><div class="value kv"><span class="swatch" id="sw"></span><span id="lc">â€”</span></div></div>
          <div class="row"><div class="label">ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ </div><div class="value" id="li">â€”</div></div>
          <div class="row"><div class="label">ãƒ©ãƒƒã‚­ãƒ¼ãƒŠãƒ³ãƒãƒ¼</div><div class="value" id="ln">â€”</div></div>
          <div class="row"><div class="label">é‹å‘½æ•°</div><div class="value" id="life">â€” <span class="note">ï¼ˆä»Šæ—¥ã®æ—¥ä»˜ã‹ã‚‰ç®—å‡ºï¼‰</span></div></div>
        </div>
      </section>

      <aside class="card side">
        <h3>å±¥æ­´</h3>
        <div class="history" id="hist"></div>
        <div class="sep"></div>
        <div class="list">
          <button id="saveimg">ã‚«ãƒ¼ãƒ‰ç”»åƒã‚’ç”Ÿæˆ</button>
          <a id="download" class="pill" href="#" download="fortune-card.png" hidden>ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
          <p class="note">â€» ç”»åƒã¯ã“ã®ãƒšãƒ¼ã‚¸å†…ã ã‘ã§ç”Ÿæˆã€‚å¤–éƒ¨é€ä¿¡ãªã—ã€‚</p>
        </div>
        <div class="sep"></div>
        <div class="center">
          <canvas id="card" width="1200" height="630" aria-label="ã‚·ã‚§ã‚¢ç”¨ã‚«ãƒ¼ãƒ‰ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰"></canvas>
        </div>
      </aside>
    </div>
  </div>
</div>

<script>
/* ===== è¨­å®šï¼ˆã“ã“ã ã‘å¼„ã‚Œã°æ–‡è¨€ã‚„ç¢ºç‡ã‚’èª¿æ•´ã§ãã¾ã™ï¼‰ ===== */

// é‹å‹¢ã®é‡ã¿ï¼ˆåˆè¨ˆ100ã«ã—ãªãã¦ã‚‚OKï¼‰
const RANKS = [
  { key: "å¤§å‰", weight: 5,  note: "ãŠå‰ãŸã¡ã®ã‚„ã£ãŸã“ã¨ã¯ã€å…¨éƒ¨ãƒãƒ«ã£ã¨ã‚¹ãƒªãƒƒãƒˆãŠè¦‹é€šã—ã ï¼" },
  { key: "ä¸­å‰", weight: 18, note: "ä»¥ä¸Šã€çŸ¢éƒ¨è¬™ä¸‰ã§ã—ãŸ" },
  { key: "å°å‰", weight: 24, note: "ãŠã˜ã„æ§˜ã«ä»£ã‚ã£ã¦ã€æˆæ•—" },
  { key: "å‰",   weight: 30, note: "ãªãœã€ãƒ™ã‚¹ãƒˆã‚’ã€å°½ãã•ãªã„ã®ã‹ï¼ï¼Ÿ" },
  { key: "æœ«å‰", weight: 13, note: "ã©ã‚“ã¨ã“ã„ã€è¶…å¸¸ç¾è±¡" },
  { key: "å‡¶",   weight: 8,  note: "ã†ã‚‰ï½ãªã„ã§ãŠã‚‚ï½ã¦ãªã—" },
  { key: "å¤§å‡¶", weight: 2,  note: "çš†ãŒåŠ©ã‹ã‚‹æ–¹æ³•ãŒâ€¦ã²ã¨ã¤ã ã‘ã‚ã‚‹ã‚“ã§ã™" },
];

// å…¨ä½“ã®ã‚»ãƒªãƒ•ï¼ˆãƒ©ãƒ³ãƒ€ãƒ 1æœ¬ï¼‰
const LINES = [
  "ã€<span class='k'>åƒ•ã¯æ±å¤§ã‚’å‡ºã¦ã„ã¾ã™</span>ã€‚ã€",
  "ã€<span class='k'>ã‚‚ãˆï½ï½ï½ï½</span>ã€‚ã€",
  "ã€<span class='k'>æµçŸ³ã¯å…„è²´</span>ã˜ã‚ƒã‘ãˆã®ãŠï¼ã€‚ã€",
  "ã€æ–‡å­—ã«ã¯<span class='k'>ä¸æ€è­°ãªåŠ›ãŒ</span>ã‚ã‚Šã¾ã™ã€‚ã€",
  "ã€ç§ã«ã¯è¶…èƒ½åŠ›ãŒã‚ã‚Šã¾ã™ã€",
  "ã€è²§ä¹³ç¦æ­¢ã€",
  "ã€äººç”Ÿã®å‹åˆ©è€…ãŸã¡ã€",
];

// ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆå„1æœ¬ãšã¤ï¼‰
const TOPICS = {
  love: [
    "å¤§åˆ‡ãªã®ã¯ã€å¿ƒã€ã‚’ã¤ã‘ã‚‹äº‹ã€‚å¿ƒã¥ã‘â€¦ãŠå¿ƒã¥ã‘â€¦",
    "ã‚¢ã‚¤ã‚·ãƒ†ã‚¤ãƒã‚¹ã‚¿ã‚«ãƒ©ãƒã‚¤ãƒ©ãƒŠã‚¤",
    "ï¼“ï¼å¹´å‰ã®çŠ¯äººã¾ã åº‡ã†ã‹ï¼",
    "ã‚¹ãƒªãƒƒãƒˆï¼ï¼ï¼ï¼"
  ],
  work: [
    "ã©ã‚“ãªäººæ°—è€…ã‚‚ã€æ „å…‰ã®æ—¥ã€…ã¯ã„ã¤ã‹çµ‚ã‚ã‚‹ã€‚ã ãŒç§ã¯é•ã†",
    "å·±ã®æ¬²æœ›ã‚’æ¨ã¦ã€ç§ã«ã‚‚ã£ã¨æ—¨ã„ã‚‚ã®ã‚’ãŠã”ã‚Œ",
    "Whyã€€Don't you Do Your Best!!",
    "ã‚ˆã—ã€ã‚ã‹ã£ãŸï¼çŠ¯äººã¯ãŠå‰ã‚„ï¼ï¼"
  ],
  money: [
    "ã‚ãªãŸã¯é»„è‰²ã„ç´™ã‚’é¸ã¶",
    "æ˜æ—¥ã®æ¥ãªã„æ—¥ã¯ã‚ã£ã¦ã‚‚ã€å®¶è³ƒã®æ¥ãªã„æ—¥ã¯ç„¡ã„",
    "ç§ã¯çŸ¥ã£ã¦ã„ã‚‹ã€æœ¬ç‰©ã®éœŠèƒ½åŠ›è€…ã‚’ã€‚",
    "å¾¡æ‰‹æ´—ã¡ã‹ãŠå›ã‚’åŠ±ã¾ã™ä¼š"
  ],
  health: [
    "ã“ã‚Œã¯ã­ã€é ­ã‹ã‚‰ç›´ã«ç”Ÿãˆã¦ã‚‹ã‚‚ã‚“ãªã‚“ã§â€¦",
    "ãã†ã ã‚ˆã€‚ãŠã˜ã•ã‚“ã¯ã‚¤ãƒ³ãƒã‚­ã ã‹ã‚‰ã­",
    "æººã‚Œã‚‹è€…ã¯è—ã‚’ã‚‚ã¤ã‹ã‚€",
    "ã©ã“ã¾ã§ã‚‚æ‰‹ã®ã‹ã‹ã‚‹ã“ã¨ã‚’ï¼"
  ],
  study: [
    "ç§ã«è¨€ã‚ã›ã‚Œã° ã™ã¹ã¦ã®ãƒ›ãƒ©ãƒ¼ç¾è±¡ã¯ãƒ›ãƒ©ã«éããªã„",
    "çŠ¯äººã¯â€¦â€¦ã“ã®ä¸­ã«ã€ãŠã‚‹!",
    "ï¼“ï¼å¹´å‰ã®çŠ¯äººã¾ã åº‡ã†ã‹!",
    "ãŠã„ã—ãã†ã€ã²ã¨ã¤ãã‚Œ"
  ],
};

// ãƒ©ãƒƒã‚­ãƒ¼æƒ…å ±
const LUCKY_COLORS = [
  ["èŒœè‰²", "#b91c1c"], ["è—è‰²", "#274060"], ["è‹¥è‰", "#86b049"],
  ["æ±Ÿæˆ¸ç´«", "#6a3d79"], ["æ°´è‰²", "#73c2fb"], ["è–„ç´…", "#f2a2a2"],
  ["ç¥ç€", "#c38e36"], ["é»’æ›œ", "#222222"], ["åˆˆå®‰", "#e5d36c"]
];
const LUCKY_ITEMS = [
  "ãƒ‘ãƒ³ãƒ", "ãƒ‘ãƒ¼ãƒ", "äº€ä¸€&äº€äºŒ", "å¤§æ—¥æœ¬èµ¤æ–‘å¸è¡€è§’è™«", "æ¬¡éƒå·", "æ¬¡éƒå›äººå½¢",
  "ã†ã«ã‚ƒã«ã‚…ãºã‡ãã‚…ã†ã‚Šã‚…æ˜Ÿäºº", "è±¡ã®åƒ", "ã‚¬ãƒƒãƒ„çŸ³ã¾ã£è™«", "ãƒšã‚¤ã‚ºãƒªãƒ¼ã®æ¶™"
];
const EMOJIS = ["âœ¨","ğŸŒ¸","ğŸ—»","ğŸ¦Š","ğŸ‹","ğŸ¯","ğŸ§§","ğŸµ","ğŸ“š","ğŸ’¡"];

/* ===== å°é“å…· ===== */
const $ = (s)=>document.querySelector(s);
const $all = (s)=>Array.from(document.querySelectorAll(s));
const state = { lastKey: "", history: [] };

function hashStr(s){ let h=2166136261; for(let i=0;i<s.length;i++){ h^=s.charCodeAt(i); h+= (h<<1)+(h<<4)+(h<<7)+(h<<8)+(h<<24);} return h>>>0; }
function mulberry32(a){ return function(){ let t=a+=0x6D2B79F5; t=Math.imul(t^t>>>15,1|t); t^=t+Math.imul(t^t>>>7,61|t); return ((t^t>>>14)>>>0)/4294967296; } }
function dailySeed(){ const d=new Date(); const key=`${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`; return hashStr(key); }
function pickWeighted(rng, list){
  const sum = list.reduce((a,b)=>a+b.weight,0);
  let r = rng()*sum;
  for(const it of list){ if((r-=it.weight) < 0) return it; }
  return list[list.length-1];
}
function pick(rng, arr){ return arr[Math.floor(rng()*arr.length)] }
function lifeNumberFromDate(){
  const d = new Date(); const s = `${d.getFullYear()}${(d.getMonth()+1)}${d.getDate()}`;
  let n = s.split("").map(Number).reduce((a,b)=>a+b,0);
  while(n > 9) n = String(n).split("").map(Number).reduce((a,b)=>a+b,0);
  return n;
}
function animateReveal(){ const el=$(".reveal"); el.hidden=false; el.addEventListener("animationend",()=>el.hidden=true,{once:true}); }

/* ===== ãƒ¡ã‚¤ãƒ³ ===== */
function roll(){
  const daily = $("#daily").checked;
  const norepeat = $("#norepeat").checked;
  const cat = $("#cat").value;

  const rng = daily ? mulberry32(dailySeed()) : Math.random;
  const rank = pickWeighted(rng, RANKS);
  const line = pick(rng, LINES);

  // ã‚«ãƒ†ã‚´ãƒªé¸æŠ
  const topics = {...TOPICS};
  const choose = (k)=> pick(rng, topics[k]);

  const chosen = {
    love: cat==="love"  ? choose("love")  : choose("love"),
    work: cat==="work"  ? choose("work")  : choose("work"),
    money:cat==="money" ? choose("money") : choose("money"),
    health:cat==="health"? choose("health"): choose("health"),
    study:cat==="study" ? choose("study") : choose("study"),
  };

  const [cname, chex] = pick(rng, LUCKY_COLORS);
  const item = pick(rng, LUCKY_ITEMS);
  const ln = 1 + Math.floor(rng()*9);
  const life = lifeNumberFromDate();
  const key = `${rank.key}|${line}|${cname}|${item}|${ln}|${Object.values(chosen).join("|")}`;

  if(norepeat && state.lastKey === key){
    // ã‹ã¶ã‚Šå›é¿ï¼ˆæœ€å¤§5å›è©¦è¡Œï¼‰
    for(let i=0;i<5;i++){
      const retry = roll(); // å†å¸°ã§å¼•ãç›´ã—
      if(retry !== false) return retry;
    }
  }

  // è¡¨ç¤º
  $("#rank").innerHTML = `${rank.key} <small>${rank.note}</small>`;
  $("#line").innerHTML = line;
  $("#t-love").textContent = chosen.love;
  $("#t-work").textContent = chosen.work;
  $("#t-money").textContent = chosen.money;
  $("#t-health").textContent = chosen.health;
  $("#t-study").textContent = chosen.study;
  $("#lc").textContent = `${cname}ï¼ˆ${chex}ï¼‰`; $("#sw").style.background = chex;
  $("#li").textContent = item;
  $("#ln").textContent = `${ln} ${pick(Math.random, EMOJIS)}`;
  $("#life").textContent = life;

  // å±¥æ­´
  const summary = `${rank.key}ï½œ${stripHtml(line)}ï½œ${cname}ï½œ${item}ï½œ#${ln}`;
  state.history.unshift(summary);
  if(state.history.length>12) state.history.pop();
  $("#hist").innerHTML = state.history.map((s,i)=>`<div class="history-item">${i+1}. ${escapeHtml(s)}</div>`).join("");

  // ã‚«ãƒ¼ãƒ‰æç”»
  drawCard({rank:rank.key, note:rank.note, line:stripHtml(line), color:[cname,chex], item, ln, life, chosen});

  state.lastKey = key;
  $("#stamp").textContent = "NEW";
  animateReveal();
  return true;
}

function stripHtml(s){ const t=document.createElement("div"); t.innerHTML=s; return t.textContent || s; }
function escapeHtml(s){ return s.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;"); }

/* ===== å…±æœ‰ãƒ»ã‚³ãƒ”ãƒ¼ ===== */
$("#share").addEventListener("click", ()=>{
  const text = buildShareText();
  const url = new URL("https://twitter.com/intent/tweet");
  url.searchParams.set("text", text + " #ãã‚‡ã†ã®å ã„");
  window.open(url.toString(), "_blank");
});
$("#copy").addEventListener("click", async ()=>{
  try{ await navigator.clipboard.writeText(buildShareText()); $("#copy").textContent="ã‚³ãƒ”ãƒ¼æ¸ˆ"; setTimeout(()=>$("#copy").textContent="ã‚³ãƒ”ãƒ¼",900);}catch{}
});
function buildShareText(){
  const r = $("#rank").textContent.trim();
  const line = stripHtml($("#line").innerHTML.trim());
  const color = $("#lc").textContent.trim();
  const item = $("#li").textContent.trim();
  const ln = $("#ln").textContent.trim();
  return `ä»Šæ—¥ã®é‹å‹¢ï¼š${r}\n${line}\nãƒ©ãƒƒã‚­ãƒ¼ï¼š${color}ï¼${item}ï¼ç•ªå·${ln}`;
}

/* ===== ç”»åƒï¼ˆCanvasï¼‰ç”Ÿæˆ ===== */
function drawCard(data){
  const c = $("#card"); const ctx = c.getContext("2d");
  // èƒŒæ™¯
  const g = ctx.createLinearGradient(0,0,0,c.height);
  g.addColorStop(0,"#fff3e0"); g.addColorStop(1,"#ffffff");
  ctx.fillStyle = g; ctx.fillRect(0,0,c.width,c.height);

  // è£…é£¾
  ctx.fillStyle = "rgba(185,28,28,.08)";
  ctx.beginPath(); ctx.ellipse(1050,120, 180,70, 0, 0, Math.PI*2); ctx.fill();

  // ã‚¿ã‚¤ãƒˆãƒ«
  ctx.fillStyle = "#b91c1c";
  ctx.font = "bold 44px 'Noto Sans JP', system-ui";
  ctx.fillText("ãã‚‡ã†ã®å ã„", 60, 90);

  // ãƒ©ãƒ³ã‚¯
  ctx.fillStyle = "#111";
  ctx.font = "800 68px 'Noto Sans JP', system-ui";
  ctx.fillText(data.rank, 60, 170);
  ctx.fillStyle = "#b91c1c";
  ctx.font = "600 22px 'Noto Sans JP', system-ui";
  ctx.fillText(data.note, 60 + ctx.measureText(data.rank).width + 22, 170);

  // ãƒ¡ã‚¤ãƒ³å°è©
  ctx.fillStyle = "#222";
  wrapText(ctx, `â€œ ${data.line} â€`, 60, 230, 1080, 38, "600 30px 'Noto Serif JP', serif");

  // ãƒ†ãƒ¼ãƒ
  ctx.font = "700 22px 'Noto Sans JP', system-ui";
  ctx.fillStyle = "#333"; ctx.fillText("æ‹æ„›",60, 340); ctx.fillText("ä»•äº‹",60, 380);
  ctx.fillText("é‡‘é‹",60, 420); ctx.fillText("å¥åº·",60, 460); ctx.fillText("å­¦ã³",60, 500);
  ctx.font = "400 22px 'Noto Sans JP', system-ui"; ctx.fillStyle = "#111";
  ctx.fillText(data.chosen.love, 120, 340);
  ctx.fillText(data.chosen.work, 120, 380);
  ctx.fillText(data.chosen.money,120, 420);
  ctx.fillText(data.chosen.health,120, 460);
  ctx.fillText(data.chosen.study,120, 500);

  // ãƒ©ãƒƒã‚­ãƒ¼
  ctx.font = "700 22px 'Noto Sans JP', system-ui"; ctx.fillStyle = "#333";
  ctx.fillText("ãƒ©ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ¼", 60, 560);
  ctx.fillText("ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ", 60, 600);
  ctx.fillText("ãƒ©ãƒƒã‚­ãƒ¼ãƒŠãƒ³ãƒãƒ¼", 60, 640);
  // swatch
  ctx.fillStyle = data.color[1]; ctx.fillRect(220, 548, 26, 26); ctx.strokeStyle="#ddd"; ctx.strokeRect(220,548,26,26);
  ctx.fillStyle = "#111"; ctx.font = "400 22px 'Noto Sans JP', system-ui";
  ctx.fillText(`${data.color[0]}ï¼ˆ${data.color[1]}ï¼‰`, 260, 568);
  ctx.fillText(data.item, 220, 600);
  ctx.fillText(String(data.ln), 220, 640);

  // é‹å‘½æ•°
  ctx.fillStyle = "#333"; ctx.font = "700 22px 'Noto Sans JP', system-ui";
  ctx.fillText("é‹å‘½æ•°", 820, 560);
  ctx.fillStyle = "#111"; ctx.font = "800 76px 'Noto Sans JP', system-ui";
  ctx.fillText(String(data.life), 920, 615);
}

function wrapText(ctx, text, x, y, maxWidth, lineHeight, font){
  ctx.font = font; ctx.textBaseline="top";
  const words = text.split(/\s+/); let line = ""; let yy = y;
  for (let i=0;i<words.length;i++){
    const testLine = line + words[i] + " ";
    if (ctx.measureText(testLine).width > maxWidth && i>0){
      ctx.fillText(line, x, yy); line = words[i] + " "; yy += lineHeight;
    } else { line = testLine; }
  }
  ctx.fillText(line, x, yy);
}

$("#saveimg").addEventListener("click", ()=>{
  const a = $("#download"); a.href = $("#card").toDataURL("image/png"); a.hidden = false;
  a.textContent = "ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"; a.click();
});

/* ===== åˆæœŸåŒ– ===== */
$("#roll").addEventListener("click", ()=>roll());
if($("#daily").checked){ roll(); }
</script>
++++

